# ArcMap Kepler.gl Preprocessing Scripts

This folder contains scripts for preprocessing data to create animated arc maps using Kepler.gl. These scripts prepare data from the National Mobility Dataset for visualization.

## Scripts

1. **Kepler-preprocess.py**: 
   - Processes both half-hourly and hourly data
   - Creates separate files for "to" and "from" directions
   - Use this for detailed, time-based visualizations with direction separation

2. **Kepler-preprocess-mixed.py**:
   - Uses a mixed granularity approach
   - Determines nearby zones and uses large zone centroids for distant areas
   - Creates a single combined file
   - Use this for visualizations that require different levels of detail for near and far zones

3. **Kepler-combined-preprocessing.py**:
   - Combines "to" and "from" data into a single file
   - Uses half-hourly data only
   - Applies an offset to create visual separation between "to" and "from" trips
   - Use this for a simplified workflow with combined directions and visual separation

## Usage

1. Choose the appropriate script based on your visualization needs.
2. Run the script, providing the focus zone ID when prompted.
3. The script will generate a CSV file in the specified output directory.

## Creating Animated Kepler Arc Maps

1. Go to [Kepler.gl](https://kepler.gl/)
2. Click on "Get Started"
3. Add data: Upload the CSV file generated by one of the preprocessing scripts
4. In the Layers panel, add a new layer and select "Arc"
5. Configure the Arc layer:
   - Arc pair: fromLat, fromLon, toLat, toLon
   - Color: You can use the 'direction' column (if available) or a solid color
   - Height: Can be based on the 'trips' column for visual impact
6. In the Filters panel, add a new filter:
   - Choose the 'time' column
   - Set it to "Time Range"
   - Adjust the time steps and speed as desired
7. Play the animation using the time controls at the bottom of the map